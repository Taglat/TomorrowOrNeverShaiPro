# Деплой на Render.com

## Пошаговая инструкция

### 1. Подготовка

1. **Создайте Telegram бота:**
   - Напишите @BotFather в Telegram
   - Выполните команду `/newbot`
   - Следуйте инструкциям и получите токен

2. **Получите доступ к SHAI.pro API:**
   - Зарегистрируйтесь на SHAI.pro
   - Получите API URL и ключ

3. **Подготовьте ID кураторов:**
   - Узнайте Telegram ID кураторов (можно через @userinfobot)
   - Запишите их через запятую

### 2. Деплой на Render.com

#### Вариант A: Автоматический деплой (рекомендуется)

1. **Подключите GitHub репозиторий:**
   - Зайдите на [render.com](https://render.com)
   - Нажмите "New +" → "Web Service"
   - Подключите ваш GitHub репозиторий
   - Выберите ветку `main`

2. **Настройте сервис:**
   - **Name:** `shai-telegram-bot`
   - **Environment:** `Python 3`
   - **Build Command:** `pip install -r requirements.txt`
   - **Start Command:** `uvicorn main:app --host 0.0.0.0 --port $PORT`

3. **Настройте переменные окружения:**
   - `TELEGRAM_BOT_TOKEN` - токен вашего бота
   - `SHAI_API_URL` - URL API SHAI.pro
   - `SHAI_API_KEY` - ключ API SHAI.pro
   - `CURATOR_CHAT_IDS` - ID кураторов через запятую
   - `DATABASE_URL` - оставьте `sqlite+aiosqlite:///./shai.db`
   - `RISK_THRESHOLD` - оставьте `0.7`

4. **Запустите деплой:**
   - Нажмите "Create Web Service"
   - Дождитесь завершения сборки

#### Вариант B: Через render.yaml

1. **Загрузите файл render.yaml в корень репозитория**
2. **Создайте новый сервис:**
   - "New +" → "Blueprint"
   - Выберите ваш репозиторий
   - Render автоматически найдет render.yaml

### 3. Проверка работы

1. **Проверьте логи:**
   - В панели Render перейдите в "Logs"
   - Убедитесь, что нет ошибок

2. **Протестируйте бота:**
   - Найдите вашего бота в Telegram
   - Отправьте команду `/start`
   - Отправьте тестовое сообщение

3. **Проверьте API:**
   - Откройте URL вашего сервиса
   - Должен вернуться `{"status": "running"}`

### 4. Мониторинг

- **Логи:** Всегда доступны в панели Render
- **Метрики:** CPU, память, запросы
- **Алерты:** Настройте уведомления о сбоях

### 5. Обновления

- При пуше в `main` ветку Render автоматически пересоберет и перезапустит сервис
- Изменения в переменных окружения требуют ручного перезапуска

## Возможные проблемы

### Бот не отвечает
- Проверьте правильность `TELEGRAM_BOT_TOKEN`
- Убедитесь, что бот не заблокирован
- Проверьте логи на ошибки

### Ошибки SHAI API
- Проверьте `SHAI_API_URL` и `SHAI_API_KEY`
- Убедитесь, что API доступен
- Проверьте лимиты API

### Проблемы с базой данных
- SQLite файл создается автоматически
- При перезапуске данные сохраняются
- Для продакшена рассмотрите PostgreSQL

## Масштабирование

- **Free план:** 750 часов/месяц, 512MB RAM
- **Starter план:** $7/месяц, всегда включен, 512MB RAM
- **Standard план:** $25/месяц, 1GB RAM, автомасштабирование

## Безопасность

- Никогда не коммитьте `.env` файл
- Используйте переменные окружения Render
- Регулярно обновляйте зависимости
- Мониторьте логи на подозрительную активность
